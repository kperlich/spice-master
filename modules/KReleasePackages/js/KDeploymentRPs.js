/* * *******************************************************************************
* This file is part of SpiceCRM FulltextSearch. SpiceCRM FulltextSearch is an enhancement developed
* by aac services k.s.. All rights are (c) 2016 by aac services k.s.
*
* This Version of the SpiceCRM FulltextSearch is licensed software and may only be used in
* alignment with the License Agreement received with this Software.
* This Software is copyrighted and may not be further distributed without
* witten consent of aac services k.s.
*
* You can contact us at info@spicecrm.io
******************************************************************************* */

Ext.define("SpiceCRM.Deployment.ReleasePackageManager.model.RP",{extend:"Ext.data.Model",alias:["widget.RP"],fields:["id","name","rpstatus","rptype","release_version","set_version","release_date","required_release_regex","software_name","software_version_major","software_version_minor","software_version_release","date_entered","auth_rights"]}),Ext.define("SpiceCRM.Deployment.ReleasePackageManager.model.RPDetailCR",{extend:"Ext.data.Model",alias:["widget.RPDetailCR"],fields:["name","id","detail","date_entered"]}),Ext.define("SpiceCRM.Deployment.ReleasePackageManager.model.releasePackageStat",{extend:"Ext.data.Model",alias:["widget.releasePackageStatModel"],fields:["id","system","system_id","status","status_raw","date_modified","history"]}),Ext.define("SpiceCRM.Deployment.ReleasePackageManager.store.CRListStore",{extend:"Ext.data.Store",model:"SpiceCRM.Deployment.ReleasePackageManager.model.RPDetailCR",alias:["store.ReleasePackageManager.CRListStore"],pageSize:50,proxy:{type:"ajax",url:"KREST/kreleasepackages/getCRList",extraParams:{table:"",id:"",search:""},reader:{type:"json",rootProperty:"list",totalProperty:"total"}},sorters:[{property:"date_entered",direction:"DESC"}],autoLoad:!1,listeners:{load:function(a,b){for(var c=0;b.length>c;c++){var d=b[c].get("id"),e=Ext.data.StoreManager.lookup("ReleasePackageManagerDetailCRs").findRecord("id",d,0,!1,!0,!0);null!==e&&void 0!==e&&b[c].set("selected",!0)}}}}),Ext.define("SpiceCRM.Deployment.ReleasePackageManager.store.RPDetailCRs",{extend:"Ext.data.Store",model:"SpiceCRM.Deployment.ReleasePackageManager.model.RPDetailCR",alias:["store.ReleasePackageManager.RPDetailCRs"],proxy:{type:"ajax",url:"KREST/kreleasepackages/getCRs",extraParams:{id:""},reader:{type:"json",rootProperty:"list"}},sorters:[{property:"date_entered",direction:"DESC"}],autoLoad:!1,listeners:{load:function(a,b){for(var c=0;b.length>c;c++){var d=b[c].get("id"),e=Ext.data.StoreManager.lookup("ReleasePackageManagerDetailCRs").findRecord("id",d,0,!1,!0,!0);null!==e&&void 0!==e&&b[c].set("selected",!0)}}}}),Ext.define("SpiceCRM.Deployment.ReleasePackageManager.store.RPs",{extend:"Ext.data.Store",model:"SpiceCRM.Deployment.ReleasePackageManager.model.RP",alias:["store.ReleasePackageManager.RPs"],pageSize:50,proxy:{type:"ajax",url:"KREST/kreleasepackages",method:"GET",reader:{type:"json",rootProperty:"list",totalProperty:"total"}},sorters:[{property:"release_date",direction:"DESC"},{property:"date_entered",direction:"DESC"}],autoLoad:!0}),Ext.define("SpiceCRM.Deployment.ReleasePackageManager.store.releasePackageStats",{extend:"Ext.data.Store",model:"SpiceCRM.Deployment.ReleasePackageManager.model.releasePackageStat",alias:["store.ReleasePackageManager.releasePackageStats"],proxy:{type:"ajax",url:"KREST/kdeployment/releasePackageHistory",method:"GET",reader:{type:"json",rootProperty:"list"}},autoLoad:!1}),Ext.define("SpiceCRM.Deployment.ReleasePackageManager.store.RPStatusStore",{extend:"Ext.data.Store",field:["id","name"],alias:["store.ReleasePackageManager.RPStatusStore"],proxy:{type:"ajax",url:"KREST/kreleasepackages/statusdom",method:"GET",reader:{type:"json",rootProperty:"list"}},autoLoad:!0}),Ext.define("SpiceCRM.Deployment.ReleasePackageManager.store.RPTypeStore",{extend:"Ext.data.Store",field:["id","name"],alias:["store.ReleasePackageManager.RPTypeStore"],proxy:{type:"ajax",url:"KREST/kreleasepackages/typedom",method:"GET",reader:{type:"json",rootProperty:"list"}},autoLoad:!0}),Ext.define("SpiceCRM.Deployment.ReleasePackageManager.controller.Application",{extend:"Ext.app.Controller",doInit:function(){console.log("app controller initialized")},finishInit:function(){},onLaunch:function(){}}),Ext.define("SpiceCRM.Deployment.ReleasePackageManager.controller.MainController",{extend:"Ext.app.ViewController",requires:[],saving:!1,selected:"",alias:"controller.ReleasePackageManagerMain",loadMask:void 0,currentRecord:!1,config:{listen:{global:{resize:function(){this.view.updateLayout()},ReleasePackageManagerPackageSelected:function(a){this.currentRecord=a,a&&(this.selected=a.get("id"),this.view.down("#cancelButton").hide(),this.view.down("#saveButton").hide(),this.view.down("#statusButton").enable(),this.manageButtons(a),7==parseInt(a.get("rpstatus"))&&this.view.down("#releaseButton").hide())}}},control:{"#saveButton":{click:function(){Ext.GlobalEvents.fireEventArgs("ReleasePackageManagerSave")}},"#cancelButton":{click:function(){this.selected="",this.view.down("#cancelButton").hide(),this.view.down("#saveButton").hide(),this.view.down("#statusButton").disable(),this.manageButtons(this.currentRecord),Ext.GlobalEvents.fireEventArgs("ReleasePackageManagerPackageClear")}},"#editButton":{click:function(){this.view.down("#editButton").hide(),this.view.down("#editButton").disable(),this.view.down("#cancelButton").show(),this.view.down("#saveButton").show(),Ext.GlobalEvents.fireEventArgs("ReleasePackageManagerPackageEdit")}},"#printButton":{click:function(){window.open("index.php?action=DetailView&module=KReleasePackages&record="+this.selected+"&print=true","printwin","menubar=1,status=0,resizable=1,scrollbars=1,toolbar=0,location=1")}},"#releaseButton":{click:function(){Ext.GlobalEvents.fireEventArgs("ReleasePackageManagerPackageRelease")}},"#statusButton":{click:function(){this.releasePackageHistory()}}}},releasePackageHistory:function(){Ext.create("SpiceCRM.Deployment.ReleasePackageManager.view.statusWindow").showWithData(this.selected)},manageButtons:function(a){parseInt(a.get("rpstatus"))<2&&parseInt(a.get("auth_rights"))>=3?(this.view.down("#printButton").hide(),this.view.down("#releaseButton").hide(),this.view.down("#editButton").enable(),this.view.down("#editButton").show()):(this.view.down("#printButton").show(),4!==parseInt(a.get("rptype"))&&this.view.down("#releaseButton").show(),this.view.down("#editButton").disable(),this.view.down("#editButton").hide())}}),Ext.define("SpiceCRM.Deployment.ReleasePackageManager.controller.RPChangeRequestsReadOnlyController",{extend:"Ext.app.ViewController",alias:"controller.ReleasePackageManager.RPChangeRequestsReadOnlyController",selected:[],config:{listen:{global:{resize:function(){this.view.updateLayout()},ReleasePackageManagerPackageSelected:function(a){a&&(Ext.data.StoreManager.lookup("ReleasePackageManagerDetailReadOnlyCRs").removeAll(),Ext.data.StoreManager.lookup("ReleasePackageManagerDetailReadOnlyCRs").getProxy().extraParams.id=a.get("id"),Ext.data.StoreManager.lookup("ReleasePackageManagerDetailReadOnlyCRs").load())},ReleasePackageManagerPackageClear:function(){Ext.data.StoreManager.lookup("ReleasePackageManagerDetailReadOnlyCRs").removeAll()}}},control:{"#":{}}}}),Ext.define("SpiceCRM.Deployment.ReleasePackageManager.controller.RPDetailContainerController",{extend:"Ext.app.ViewController",saving:!1,selected:"",alias:"controller.RPDetailContainerController",loadMask:void 0,currentRecord:!1,config:{listen:{global:{resize:function(){this.view.updateLayout()},ReleasePackageManagerPackageSelected:function(a){this.currentRecord=a,this.view.setActiveTab(0),a&&(this.selected=a.get("id"),this.view.child("#changeRequestsTab").tab.hide(),this.view.child("#changeRequestsReadOnlyTab").tab.show())},ReleasePackageManagerPackageClear:function(){this.view.setActiveTab(0),this.view.child("#changeRequestsTab").tab.hide(),this.view.child("#changeRequestsReadOnlyTab").tab.show()},ReleasePackageManagerPackageEdit:function(){this.view.setActiveTab(0),this.view.child("#changeRequestsTab").tab.show(),this.view.child("#changeRequestsReadOnlyTab").tab.hide()}}}}}),Ext.define("SpiceCRM.Deployment.ReleasePackageManager.controller.RPDetailCRListController",{extend:"Ext.app.ViewController",alias:"controller.ReleasePackageManager.RPDetailCRListController",selected:[],config:{listen:{global:{resize:function(){this.view.updateLayout()},ReleasePackageManagerPackageSelected:function(a){a&&(Ext.data.StoreManager.lookup("ReleasePackageManagerDetailCRs").removeAll(),Ext.data.StoreManager.lookup("ReleasePackageManagerDetailCRs").getProxy().extraParams.id=a.get("id"),Ext.data.StoreManager.lookup("ReleasePackageManagerDetailCRs").load())},ReleasePackageManagerPackageClear:function(){Ext.data.StoreManager.lookup("ReleasePackageManagerDetailCRs").removeAll()}}},control:{"#":{selectionchange:function(a,b,c){if(b.length>0){this.view.down("#removeButtonList").enable();for(var d=0;b.length>d;d++)this.selected[d]=b[d]}else this.view.down("#removeButtonList").disable(),this.selected=[]},render:function(a){this.dropZone=new Ext.dd.DropZone(a.getEl(),{getTargetFromEvent:function(a){return a.getTarget()},onNodeOver:function(a,b,c,d){return Ext.dd.DropZone.prototype.dropAllowed},onNodeDrop:function(a,b,c,d){Ext.data.StoreManager.lookup("ReleasePackageManagerDetailCRs").add(d.draggedRecord);return d.draggedRecord.set("selected",!0),console.log(d.draggedRecord),!0}})}},"#removeButtonList":{click:function(){for(var a=0;this.selected.length>a;a++){this.selected[a].set("selected",!1);var b=Ext.data.StoreManager.lookup("ReleasePackageManagerDetailCRs").findRecord("id",this.selected[a].get("id"),0,!1,!0,!0);null!==b&&void 0!==b&&b.set("selected",!1),Ext.data.StoreManager.lookup("ReleasePackageManagerDetailCRs").remove(this.selected[a])}this.selected=[]}}}}}),Ext.define("SpiceCRM.Deployment.ReleasePackageManager.controller.RPDetailCRViewController",{extend:"Ext.app.ViewController",alias:"controller.ReleasePackageManager.RPDetailCRViewController",config:{listen:{global:{resize:function(){this.view.updateLayout()},ReleasePackageManagerPackageSelected:function(a){a&&(Ext.data.StoreManager.lookup("ReleasePackageManagerCRListStore").removeAll(),this.view.up("app-main").down("#CRFilter").setValue(""),Ext.data.StoreManager.lookup("ReleasePackageManagerCRListStore").load())},ReleasePackageManagerPackageClear:function(){Ext.data.StoreManager.lookup("ReleasePackageManagerCRListStore").removeAll(),this.view.up("app-main").down("#CRFilter").setValue(""),Ext.data.StoreManager.lookup("ReleasePackageManagerCRListStore").load()}}},control:{"#":{render:function(a){this.dragZone=new Ext.dd.DragZone(a.getEl(),{getDragData:function(b){var c=b.getTarget(a.itemSelector,10);if(c)return d=c,{ddel:d,sourceEl:c,repairXY:Ext.fly(c).getXY(),sourceStore:a.store,draggedRecord:b.record}},getRepairXY:function(){return this.dragData.repairXY},onBeforeDrag:function(a,b){return void 0!==a.draggedRecord&&null!==a.draggedRecord&&((void 0===a.draggedRecord||!a.draggedRecord.get("selected"))&&void 0)}})}}}}}),Ext.define("SpiceCRM.Deployment.ReleasePackageManager.controller.RPDetailFormController",{extend:"Ext.app.ViewController",alias:"controller.ReleasePackageManager.RPDetailFormController",saveConfirm:!1,currentRecord:!1,config:{listen:{global:{ReleasePackageManagerPackageSelected:function(a){a&&(this.currentRecord=a,this.view.getViewModel().set("rp",a),3===a.get("rptype")?this.view.down("#software_info_panel").show():this.view.down("#software_info_panel").hide(),this.disableForm())},ReleasePackageManagerDetailsFormClear:function(){},ReleasePackageManagerSave:function(){this.saveRP()},ReleasePackageManagerPackageClear:function(){this.currentRecord.reject(),this.disableForm()},ReleasePackageManagerPackageRelease:function(){var a=this.view.getViewModel().get("rp");this.view.up("app-main").down("#saveButton").hide(),this.view.up("app-main").down("#cancelButton").hide();var b=new Ext.LoadMask({msg:"releasing...",target:this.view.up("app-main")});b.show(),Ext.Ajax.request({url:"KREST/kreleasepackages/release/"+a.get("id"),method:"GET",success:function(a,c){var d=(JSON.parse(a.responseText),this.view.getViewModel().get("rp"));d.set("rpstatus",7),b.hide(),Ext.GlobalEvents.fireEventArgs("ReleasePackageManagerPackageSelected",[d])},failure:function(a,c){console.log("server-side failure with status code "+a.status),Ext.Msg.alert("Error","server-side failure with status code "+a.status),b.hide()},scope:this})},ReleasePackageManagerPackageEdit:function(){this.enableForm()}}},control:{"#rptype":{select:function(a,b){3===b.get("id")?this.view.down("#software_info_panel").show():this.view.down("#software_info_panel").hide()}}}},enableForm:function(){this.view.up("app-main").down("#cancelButton").enable(),this.view.isValid()?this.view.up("app-main").down("#saveButton").enable():this.view.up("app-main").down("#saveButton").disable(),this.view.up("app-main").down("#editButton").hide(),this.view.getForm().getFields().each(function(a){!1!==a.autoenable&&a.enable()},this)},disableForm:function(){this.view.up("app-main").down("#saveButton").hide(),this.view.up("app-main").down("#cancelButton").hide(),this.view.up("app-main").down("#saveButton").disable(),this.view.up("app-main").down("#cancelButton").disable(),this.view.up("app-main").down("#editButton").show(),this.view.getForm().getFields().each(function(a){!1!==a.autoenable&&a.disable()},this)},saveRP:function(){if(this.view.isValid()){this.view.up("app-main").down("#saveButton").disable(),this.view.up("app-main").down("#cancelButton").disable();var a=new Ext.LoadMask({msg:"saving...",target:this.view.up("app-main")});a.show();var b=this.view.getForm().getFieldValues(),c=[];Ext.data.StoreManager.lookup("ReleasePackageManagerDetailCRs").each(function(a){c.push(a.get("id"))}),b.crs=Ext.JSON.encode(c),Ext.Ajax.request({url:"KREST/kreleasepackages",method:"POST",jsonData:b,success:function(b,c){var d=JSON.parse(b.responseText),e=this.view.getViewModel().get("rp");void 0!==d.date_entered&&null!==d.date_entered&&d.date_entered.length>0&&e.set("date_entered",d.date_entered),a.hide(),Ext.GlobalEvents.fireEventArgs("ReleasePackageManagerPackageSelected",[e])},failure:function(b,c){console.log("server-side failure with status code "+b.status),Ext.Msg.alert("Error","server-side failure with status code "+b.status),a.hide(),this.view.up("app-main").down("#saveButton").enable(),this.view.up("app-main").down("#cancelButton").enable()},scope:this})}else Ext.Msg.alert("required fields","please fill all required fields")}}),Ext.define("SpiceCRM.Deployment.ReleasePackageManager.controller.RPListController",{extend:"Ext.app.ViewController",alias:"controller.ReleasePackageManager.RPListController",selected:[],config:{listen:{global:{ReleasePackageManagerNewPackage:function(a){Ext.data.StoreManager.lookup("ReleasePackageManagerRPs").add(a),Ext.GlobalEvents.fireEventArgs("ReleasePackageManagerPackageSelected",[a]),this.selected=[],this.selected.push(a),parseInt(a.get("rpstatus"))<2&&5==parseInt(a.get("auth_rights"))?this.view.down("#deleteButtonList").enable():this.view.down("#deleteButtonList").disable()},ReleasePackageManagerSelectPackage:function(a){this.view.setSelection(a)}}},control:{"#":{select:function(a,b){Ext.GlobalEvents.fireEventArgs("ReleasePackageManagerPackageSelected",[b]),this.selected=[],this.selected.push(b),parseInt(b.get("rpstatus"))<2&&5==parseInt(b.get("auth_rights"))?this.view.down("#deleteButtonList").enable():this.view.down("#deleteButtonList").disable()}},"#addButtonList":{click:function(){this.addRP()}},"#deleteButtonList":{click:function(){Ext.Ajax.request({url:"KREST/kreleasepackages/"+this.selected[0].get("id"),method:"DELETE",success:function(a,b){Ext.data.StoreManager.lookup("ReleasePackageManagerRPs").remove(this.selected[0]),this.view.setSelection([]),this.view.down("#deleteButtonList").disable(),Ext.GlobalEvents.fireEventArgs("ReleasePackageManagerPackageClear")},failure:function(a,b){console.log("server-side failure with status code "+a.status),Ext.Msg.alert("Error","server-side failure with status code "+a.status)},scope:this})}}}},addRP:function(){Ext.widget("window",{title:"New Release Package",closeAction:"hide",width:300,height:250,layout:"fit",resizable:!0,modal:!0,items:[Ext.widget("form",{layout:{type:"vbox",align:"stretch"},border:!1,bodyPadding:10,fieldDefaults:{labelAlign:"top",labelWidth:100,labelStyle:"font-weight:bold"},items:[{xtype:"textfield",fieldLabel:"Name",itemId:"new_rp_name",allowBlank:!1},{xtype:"combo",itemId:"new_rp_type",name:"rptype",fieldLabel:"Type",store:Ext.data.StoreManager.lookup("ReleasePackageManagerTypes"),queryMode:"local",displayField:"name",valueField:"id",forceSelection:!0,allowBlank:!1}],buttons:[{text:"Cancel",handler:function(){this.up("form").getForm().reset(),this.up("window").hide()}},{text:"Ok",handler:function(){if(this.up("form").getForm().isValid()){var a=new Ext.LoadMask({msg:"saving...",target:this.up("window")});a.show();var b=this.up("form").down("#new_rp_name").getValue(),c=this.up("form").down("#new_rp_type").getValue(),d=SpiceCRM.Deployment.ReleasePackageManager.Application.kGuid();Ext.Ajax.request({url:"KREST/kreleasepackages",method:"POST",jsonData:{name:b,rptype:c,id:d,rpstatus:0},success:function(b,c){var d=JSON.parse(b.responseText),e=Ext.create("SpiceCRM.Deployment.ReleasePackageManager.model.RP",{id:d.id,name:d.name,rptype:d.rptype,rpstatus:0,auth_rights:5});void 0!==d.date_entered&&null!==d.date_entered&&d.date_entered.length>0&&e.set("date_entered",d.date_entered),Ext.data.StoreManager.lookup("ReleasePackageManagerRPs").insert(0,e),Ext.GlobalEvents.fireEventArgs("ReleasePackageManagerSelectPackage",[e]),a.hide(),this.up("window").hide()},failure:function(b,c){console.log("server-side failure with status code "+b.status),Ext.Msg.alert("Error","server-side failure with status code "+b.status),a.hide(),this.up("window").hide()},scope:this})}}}]})]}).show()}}),Ext.define("SpiceCRM.Deployment.ReleasePackageManager.view.main.Main",{extend:"Ext.container.Container",requires:["SpiceCRM.Deployment.ReleasePackageManager.controller.MainController"],xtype:"app-main",renderTo:"ReleasePackageManager",height:"100%",width:"100%",border:!1,controller:"ReleasePackageManagerMain",itemId:"ReleasePackageManagerMain",viewModel:{},layout:{type:"border"},style:{"background-color":"transparent"},items:[{xtype:"ReleasePackageManager.RPList",region:"west",itemId:"CRListItem",flex:1,margin:"0 0 0 0",split:!0},{xtype:"tabpanel",region:"center",itemId:"DetailTabs",controller:"RPDetailContainerController",flex:3,items:[{title:"Main",xtype:"ReleasePackageManager.RPDetailForm",icon:"modules/KDeploymentSystems/images/form.png",itemId:"mainTab"},{title:"Change Requests",xtype:"ReleasePackageManager.RPDetailCRContainer",itemId:"changeRequestsTab",icon:"themes/SpiceTheme/images/KReleasePackages.gif",hidden:!0},{title:"Change Requests",xtype:"ReleasePackageManager.RPChangeRequestsReadOnly",icon:"themes/SpiceTheme/images/KReleasePackages.gif",itemId:"changeRequestsReadOnlyTab",hidden:!0}],dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"button",text:"save",itemId:"saveButton",icon:"themes/SpiceTheme/images/save.png",disabled:!0},{xtype:"button",text:"cancel",icon:"themes/SpiceTheme/images/cancel.png",itemId:"cancelButton",disabled:!0},{xtype:"button",text:"print",itemId:"printButton",icon:"themes/SpiceTheme/images/print.png",hidden:!0},{xtype:"button",text:"release",icon:"themes/SpiceTheme/images/release.png",itemId:"releaseButton",hidden:!0},{xtype:"button",text:"edit",icon:"themes/SpiceTheme/images/edit.png",itemId:"editButton",hidden:!0,disabled:!0},"->",{xtype:"button",text:"status",icon:"themes/SpiceTheme/images/status.png",itemId:"statusButton",disabled:!0}]}]}],listeners:{}}),Ext.define("SpiceCRM.Deployment.ReleasePackageManager.view.RPChangeRequestsReadOnly",{extend:"Ext.grid.Panel",alias:["widget.ReleasePackageManager.RPChangeRequestsReadOnly"],store:Ext.create("SpiceCRM.Deployment.ReleasePackageManager.store.RPDetailCRs",{storeId:"ReleasePackageManagerDetailReadOnlyCRs"}),controller:"ReleasePackageManager.RPChangeRequestsReadOnlyController",flex:1,height:"100%",itemId:"RPChangeRequestsReadOnly",columns:[{text:"Name",dataIndex:"name",flex:5,tooltip:"hover to see full text",padding:"7 0 6 6",renderer:function(a,b){return b.tdAttr='alt="'+a+'" title="'+a+'"',a}}],viewConfig:{stripeRows:!0,markDirty:!1}}),Ext.define("SpiceCRM.Deployment.ReleasePackageManager.view.RPDetailCRContainer",{extend:"Ext.panel.Panel",alias:["widget.ReleasePackageManager.RPDetailCRContainer"],height:"100%",border:!1,itemId:"RPDetailCRContainer",layout:{type:"hbox"},items:[{xtype:"ReleasePackageManager.RPDetailCRView",flex:1,split:!0},{xtype:"ReleasePackageManager.RPDetailCRList",flex:1}],listeners:{}}),Ext.define("SpiceCRM.Deployment.ReleasePackageManager.view.RPDetailCRList",{extend:"Ext.grid.Panel",alias:["widget.ReleasePackageManager.RPDetailCRList"],controller:"ReleasePackageManager.RPDetailCRListController",store:Ext.create("SpiceCRM.Deployment.ReleasePackageManager.store.RPDetailCRs",{storeId:"ReleasePackageManagerDetailCRs"}),flex:1,height:"100%",itemId:"RPDetailCRList",columns:[{text:"Name",dataIndex:"name",flex:5,tooltip:"hover to see full text",padding:"7 0 6 6"}],selModel:{selType:"rowmodel",mode:"MULTI"},viewConfig:{stripeRows:!0,markDirty:!1},dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"button",text:"remove",icon:"themes/SpiceTheme/images/delete.png",itemId:"removeButtonList",disabled:!0}]}]}),Ext.define("SpiceCRM.Deployment.ReleasePackageManager.view.RPDetailCRView",{extend:"Ext.grid.Panel",alias:["widget.ReleasePackageManager.RPDetailCRView"],controller:"ReleasePackageManager.RPDetailCRViewController",store:Ext.create("SpiceCRM.Deployment.ReleasePackageManager.store.CRListStore",{storeId:"ReleasePackageManagerCRListStore"}),flex:1,height:"100%",border:!1,itemId:"RPDetailCRView",table:"",search:"",columns:[{text:"Name",dataIndex:"name",flex:5,sortable:!1}],viewConfig:{markDirty:!1,getRowClass:function(a){return a.get("selected")?"treeview_highlighted_row":""}},dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"textfield",itemId:"CRDBFilter",listeners:{change:function(a,b,c,d){var e=Ext.data.StoreManager.lookup("ReleasePackageManagerCRListStore");b!==c&&(b.length>=3?(e.removeAll(),e.getProxy().extraParams.search=b,e.load({params:{start:0,limit:50}})):(e.removeAll(),e.getProxy().extraParams.search="",e.load({params:{start:0,limit:50}})))}}}]},{xtype:"pagingtoolbar",store:"ReleasePackageManagerCRListStore",dock:"bottom",displayInfo:!0}]}),Ext.define("SpiceCRM.Deployment.ReleasePackageManager.view.RPDetailForm",{extend:"Ext.form.Panel",alias:["widget.ReleasePackageManager.RPDetailForm"],controller:"ReleasePackageManager.RPDetailFormController",title:"Release Package Details",layout:"container",listeners:{validitychange:function(a,b,c){b?this.up("app-main").down("#saveButton").enable():this.up("app-main").down("#saveButton").disable()}},viewModel:{data:{rp:{}}},scrollable:"vertical",itemId:"RPDetailForm",items:[{title:"Release Package Info",xtype:"fieldset",collapsible:!1,defaultType:"textfield",defaults:{anchor:"100%",border:!1},margin:"0 5 0 5",layout:"hbox",items:[{xtype:"panel",layout:"vbox",flex:1,items:[{xtype:"textfield",fieldLabel:"Name",itemId:"name",name:"name",allowBlank:!1,bind:"{rp.name}",disabled:!0},{xtype:"combo",itemId:"rpstatus",name:"rpstatus",fieldLabel:"Status",store:Ext.create("SpiceCRM.Deployment.ReleasePackageManager.store.RPStatusStore",{storeId:"ReleasePackageManagerStati"}),queryMode:"local",displayField:"name",valueField:"id",forceSelection:!0,allowBlank:!1,bind:"{rp.rpstatus}",disabled:!0}]},{xtype:"panel",layout:"vbox",flex:1,items:[{xtype:"datefield",itemId:"release_date",name:"release_date",fieldLabel:"Release Date",bind:"{rp.release_date}",format:window.cal_date_format.replace(/%/g,""),disabled:!0},{xtype:"combo",itemId:"rptype",name:"rptype",fieldLabel:"Type",store:Ext.create("SpiceCRM.Deployment.ReleasePackageManager.store.RPTypeStore",{storeId:"ReleasePackageManagerTypes"}),queryMode:"local",displayField:"name",valueField:"id",forceSelection:!0,allowBlank:!1,bind:"{rp.rptype}",disabled:!0}]},{xtype:"hiddenfield",name:"id",itemId:"id",bind:"{rp.id}"}]},{title:"Version Info",itemId:"version_info_panel",xtype:"fieldset",collapsible:!1,defaultType:"textfield",layout:"hbox",defaults:{anchor:"100%",border:!1},margin:"0 5 0 5",items:[{xtype:"panel",layout:"vbox",flex:1,items:[{xtype:"textfield",itemId:"release_version",name:"release_version",fieldLabel:"Version",bind:"{rp.release_version}",disabled:!0},{xtype:"checkboxfield",itemId:"set_version",name:"set_version",fieldLabel:"Set Version",inputValue:"1",bind:"{rp.set_version}",disabled:!0}]},{xtype:"panel",layout:"vbox",flex:1,items:[{xtype:"textfield",itemId:"required_release_regex",name:"required_release_regex",fieldLabel:"Required Release Regex",bind:"{rp.required_release_regex}",disabled:!0}]}]},{title:"Software Info",itemId:"software_info_panel",xtype:"fieldset",collapsible:!1,hidden:!0,defaultType:"textfield",defaults:{anchor:"100%",border:!1},margin:"0 5 0 5",layout:"hbox",items:[{xtype:"panel",layout:"vbox",flex:1,items:[{xtype:"textfield",fieldLabel:"Package Name",itemId:"software_name",name:"software_name",bind:"{rp.software_name}",disabled:!0}]},{xtype:"panel",layout:"vbox",flex:1,items:[{xtype:"fieldcontainer",fieldLabel:"Version",layout:"hbox",items:[{xtype:"numberfield",itemId:"software_version_major",name:"software_version_major",bind:"{rp.software_version_major}",minValue:0,maxValue:9999,disabled:!0,width:100},{xtype:"numberfield",itemId:"software_version_minor",name:"software_version_minor",bind:"{rp.software_version_minor}",minValue:0,maxValue:9999,disabled:!0,width:100},{xtype:"numberfield",itemId:"software_version_release",name:"software_version_release",bind:"{rp.software_version_release}",minValue:0,maxValue:9999,disabled:!0,width:100}]}]}]}]}),Ext.define("SpiceCRM.Deployment.ReleasePackageManager.view.RPList",{extend:"Ext.grid.Panel",alias:["widget.ReleasePackageManager.RPList"],controller:"ReleasePackageManager.RPListController",store:Ext.create("SpiceCRM.Deployment.ReleasePackageManager.store.RPs",{storeId:"ReleasePackageManagerRPs"}),flex:1,height:"100%",itemId:"RPList",columns:[{text:"Name",dataIndex:"name",flex:5,padding:"7 0 6 6",sortable:!1,renderer:function(a,b){return b.tdAttr='alt="'+a+'" title="'+a+'"',a}},{text:"Date",dataIndex:"date_entered",flex:3,padding:"7 0 6 6",sortable:!1,renderer:function(a,b){return b.tdAttr='alt="'+a+'" title="'+a+'"',a}},{text:"Status",dataIndex:"rpstatus",flex:2,encodeHtml:!1,sortable:!1,renderer:function(a){switch(parseInt(a)){case 0:return"created";case 1:return"in progress";case 2:return"completed";case 3:return"in test";case 4:return"delivered";case 5:return"fetched";case 6:return"deployed";case 7:return"released"}}}],viewConfig:{stripeRows:!0,markDirty:!1},dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"button",text:"add",icon:"themes/SpiceTheme/images/add.png",itemId:"addButtonList",disabled:!1},{xtype:"button",text:"delete",icon:"themes/SpiceTheme/images/delete.png",itemId:"deleteButtonList",disabled:!0}]},{xtype:"toolbar",dock:"top",items:[{xtype:"textfield",itemId:"CRFilter",flex:1,listeners:{change:function(a,b,c,d){var e=Ext.data.StoreManager.lookup("ReleasePackageManagerRPs");b!==c&&(b.length<=3?(e.clearFilter(),"9"==a.up("panel").down("#statusFilter").getValue()||null===a.up("panel").down("#statusFilter").getValue()?e.removeFilter("rpstatus"):e.filter("rpstatus",a.up("panel").down("#statusFilter").getValue())):e.filterBy(function(a,c){return-1!=(a.get("name")||" ").indexOf(b)}))}}},{xtype:"combo",itemId:"statusFilter",flex:1,store:Ext.create("Ext.data.Store",{fields:["val","name"],data:[{val:"9",name:"-no filter-"},{val:"0",name:"created"},{val:"1",name:"in progress"},{val:"2",name:"completed"},{val:"3",name:"in test"},{val:"4",name:"delivered"},{val:"5",name:"fetched"},{val:"6",name:"deployed"},{val:"7",name:"released"}]}),queryMode:"local",displayField:"name",valueField:"val",listeners:{change:function(a,b,c,d){var e=Ext.data.StoreManager.lookup("ReleasePackageManagerRPs");b!==c&&e.filter("rpstatus",b),"9"==b&&e.removeFilter("rpstatus")}}}]},{xtype:"pagingtoolbar",store:"ReleasePackageManagerRPs",dock:"bottom",displayInfo:!0}]}),Ext.define("SpiceCRM.Deployment.ReleasePackageManager.view.statusWindow",{extend:"Ext.window.Window",alias:["widget.ReleasePackageManager.statusWindow"],height:400,width:400,modal:!0,systemrecord:void 0,closable:!1,title:"Package Stats",layout:"fit",items:{xtype:"grid",viewConfig:{markDirty:!1,getRowClass:function(a,b,c,d){return"0"===a.data.history?"spicedeploy-bold-row":""}},columns:[{text:"System",dataIndex:"system",flex:1},{text:"Status",dataIndex:"status"},{text:"Date",dataIndex:"date_modified"}]},bbar:[{xtype:"checkboxfield",itemId:"historyFilter",boxLabel:"only current status",inputValue:"1",listeners:{change:function(a,b,c,d){var e=Ext.data.StoreManager.lookup("ReleasePackageManagerReleasePackageStats");!0===b?e.filter("history","0"):e.clearFilter()}}},"->",{xtype:"button",text:"close",itemId:"statusWindowCloseButton",handler:function(a){a.up("window").close()}}],showWithData:function(a){var b=Ext.create("SpiceCRM.Deployment.ReleasePackageManager.store.releasePackageStats",{storeId:"ReleasePackageManagerReleasePackageStats"});b.getProxy().url+="/"+a,b.load(),b.sort([{property:"system_id",direction:"ASC"},{property:"date_modified",direction:"DESC"}]),this.show(),this.down("grid").setStore(b)}}),Ext.define("SpiceCRM.Deployment.ReleasePackageManager.Application",{namespaces:["SpiceCRM.Deployment.ReleasePackageManager"],controllers:["Application"],extend:"Ext.app.Application",name:"SpiceCRM.Deployment.ReleasePackageManager",launch:function(){Ext.create("SpiceCRM.Deployment.ReleasePackageManager.view.main.Main"),SpiceCRM.Deployment.ReleasePackageManager.Application=this},languageGetText:function(a){return SUGAR.language.get("KReleasePackages",a)},S4:function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},kGuid:function(){return"k"+this.S4()+this.S4()+this.S4()+this.S4()+this.S4()+this.S4()+this.S4()}}),Ext.application({extend:"SpiceCRM.Deployment.ReleasePackageManager.Application"});