/* * *******************************************************************************
* This file is part of SpiceCRM FulltextSearch. SpiceCRM FulltextSearch is an enhancement developed
* by aac services k.s.. All rights are (c) 2016 by aac services k.s.
*
* This Version of the SpiceCRM FulltextSearch is licensed software and may only be used in
* alignment with the License Agreement received with this Software.
* This Software is copyrighted and may not be further distributed without
* witten consent of aac services k.s.
*
* You can contact us at info@spicecrm.io
******************************************************************************* */

var SpiceCRM=angular.module("SpiceCRM",[]);SpiceCRM.controller("FavoritesCtrl",["$scope","FavoritesService","UserConfigService",function(a,b,c){angular.extend(a,{favoritesWidget:{name:"Favorites",label:"Favorites",closed:!1,class:function(){return"true"!==c.objects.Favorites_collapsed?"open":"close"},isFavorite:function(){b.checkIsFavorite().then(function(a){return b.isFavorite},function(){$("#Favorites").hide()})},toggleFavorite:function(){b.isFavorite?b.delete_favorite():b.set_favorite()}},userConfigService:c,favoritesService:b})}]),SpiceCRM.directive("favoritesWidget",[function(){return{restrict:"E",templateUrl:"themes/SpiceTheme/js/Widgets/Favorites/template.html",controller:"FavoritesCtrl",replace:!0,scope:!1}}]),SpiceCRM.directive("favoritesItem",[function(){return{restrict:"E",templateUrl:"themes/SpiceTheme/js/Widgets/Favorites/entry.html",replace:!0,scope:{itemData:"="}}}]),SpiceCRM.factory("FavoritesService",["$http","UserConfigService","SessionStorageService","$q",function(a,b,c,d){var e={userConfigService:b,objects:[],loading:!1,isFavorite:!1,load:function(){var b=d.defer();e.loading=!0;var f=c.getParam("favoritesWidgetData");return!1===f||0===f.length?a({method:"GET",url:"KREST/theme/Favorites"}).success(function(a){b.resolve(a)}):(e.objects=c.getParam("favoritesWidgetData"),b.resolve(e.objects)),e.checkIsFavorite().then(function(){e.loading=!1}),b.promise},checkIsFavorite:function(){var b=d.defer(),f=$('form[name$="View"] input[name="module"]').val(),g=$('form[name$="View"] input[name="record"]').val(),h=!1;if(e.objects=c.getParam("favoritesWidgetData"),f&&g){if(e.objects.length>0)for(index=0;index<e.objects.length;++index)e.objects[index].item_id==g&&(h=!0);h?(e.isFavorite=h,b.resolve(h)):a({method:"GET",url:"KREST/theme/Favorites/"+f+"/"+g}).success(function(a){e.isFavorite=a.isFavorite,h=a.isFavorite,b.resolve(h)})}else b.reject();return b.promise},set_favorite:function(){var b=$('form[name$="View"] input[name="module"]').val(),d=$('form[name$="View"] input[name="record"]').val();if(b&&d){a({method:"POST",url:"KREST/theme/Favorites/"+b+"/"+d}).success(function(a){e.isFavorite=!0});var f={item_id:d,module_name:b,item_summary:$("#moduleTitleDummy h2").text(),item_summary_short:$("#moduleTitleDummy h2").text().substr(0,15)};e.objects.push(f),c.setParam("favoritesWidgetData",e.objects)}},delete_favorite:function(){var b=$('form[name$="View"] input[name="module"]').val(),c=$('form[name$="View"] input[name="record"]').val();if(b&&c)for(a({method:"DELETE",url:"KREST/theme/Favorites/"+b+"/"+c}).success(function(a){e.isFavorite=!1}),index=0;index<e.objects.length;++index)e.objects[index].item_id==c&&e.objects.splice(index,1)}};return e.userConfigService.load(),e.load().then(function(a){e.objects=a,c.setParam("favoritesWidgetData",a),e.loading=!1}),e}]),SpiceCRM.controller("LastViewedCtrl",["$scope","LastViewedService","UserConfigService",function(a,b,c){angular.extend(a,{lastViewedWidget:{name:"LastViewed",label:"Last Viewed",closed:!1,class:function(){return"true"!==c.objects.LastViewed_collapsed?"open":"close"}},userConfigService:c,lastViewedService:b})}]),SpiceCRM.directive("lastViewedWidget",[function(){return{restrict:"E",templateUrl:"themes/SpiceTheme/js/Widgets/LastViewed/template.html",controller:"LastViewedCtrl",replace:!0}}]),SpiceCRM.directive("lastViewedItem",[function(){return{restrict:"E",templateUrl:"themes/SpiceTheme/js/Widgets/LastViewed/entry.html",replace:!0,scope:{itemData:"="}}}]),SpiceCRM.factory("LastViewedService",["$http","UserConfigService","SessionStorageService",function(a,b,c){var d={userConfigService:b,objects:[],loading:!1,load:function(){if(d.loading=!0,!1===c.getParam("lastViewedWidgetData"))a({method:"GET",url:"KREST/theme/getLastViewed"}).success(function(a){d.objects=a,c.setParam("lastViewedWidgetData",a)});else if(d.objects=c.getParam("lastViewedWidgetData"),$('form[name="DetailView"]').length>0){var b=$("<textarea/>").html($(".moduleTitle h2").html()).text(),e={id:1,item_id:$('form[name="DetailView"] input[name="record"]').val(),item_summary:b,item_summary_short:b.substring(0,13)+"...",module_name:$('form[name="DetailView"] input[name="module"]').val()};if("object"==typeof d.objects){var f=[];for(var g in d.objects)d.objects.hasOwnProperty(g)&&f.push(d.objects[g]);d.objects=f}else d.objects=[];var h;for(h=0;h<d.objects.length;++h)d.objects[h].item_id==e.item_id&&d.objects.splice(h,1);d.objects.unshift(e),d.objects=d.objects.splice(0,10),c.setParam("lastViewedWidgetData",d.objects)}d.loading=!1}};return d.userConfigService.load(),d.load(),d}]),SpiceCRM.controller("shortcutsCtrl",["$scope","shortcutsService","UserConfigService",function(a,b,c){angular.extend(a,{shortcutsWidget:{name:"Shortcuts",label:"Shortcuts",closed:!1,class:function(){return"true"!==c.objects.Shortcuts_collapsed?"open":"close"}},userConfigService:c,shortcutsService:b})}]),SpiceCRM.directive("shortcutsWidget",[function(){return{restrict:"E",templateUrl:"themes/SpiceTheme/js/Widgets/Shortcuts/template.html",controller:"shortcutsCtrl",replace:!0}}]),SpiceCRM.directive("shortcutsItem",[function(){return{restrict:"E",templateUrl:"themes/SpiceTheme/js/Widgets/Shortcuts/entry.html",replace:!0,scope:{itemData:"="}}}]),SpiceCRM.factory("shortcutsService",["$http","$window","UserConfigService","SessionStorageService",function(a,b,c,d){var e={userConfigService:c,objects:[],loading:!1,load:function(){e.loading=!0;var c=d.getParam("shortcuts");!1===c||void 0===c[b.currentModule]?a({method:"GET",url:"KREST/theme/getShortcuts/"+b.currentModule}).success(function(a){e.objects=a,!1===c?(c={},c[b.currentModule]=a):c[b.currentModule]=a,d.setParam("shortcuts",c)}):e.objects=c[b.currentModule],e.loading=!1}};return e.userConfigService.load(),e.load(),e}]),SpiceCRM.factory("SessionStorageService",["$window",function(a){var b={getParam:function(c){var d;return void 0!==a.sessionStorage[b.readCookie("PHPSESSID")]&&(d=angular.fromJson(a.sessionStorage[b.readCookie("PHPSESSID")])),void 0!==d&&void 0!==d[c]&&d[c]},setParam:function(c,d){var e=angular.fromJson(a.sessionStorage[b.readCookie("PHPSESSID")]);void 0===e&&(e={}),e[c]=d,a.sessionStorage[b.readCookie("PHPSESSID")]=angular.toJson(e)},readCookie:function(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "==e.charAt(0);)e=e.substring(1,e.length);if(0===e.indexOf(b))return e.substring(b.length,e.length)}return null}};return b}]),SpiceCRM.factory("UserConfigService",["$http","$window","SessionStorageService",function(a,b,c){var d={objects:[],load:function(){var b;b=c.getParam("userConfig"),!1===b?a({method:"GET",url:"KREST/theme/getConfig"}).success(function(a){d.objects=a,c.setParam("userConfig",a)}):d.objects=b},toggle:function(a,c){b.spicetheme.collapsedStatic[a]||!c?(b.spicetheme.collapsed[a]=!1,c&&(b.spicetheme.collapsedStatic[a]=!1,b.spicetheme.setToggle(!1,a),d.setParam(a,!1))):(b.spicetheme.collapsed[a]=!0,c&&(b.spicetheme.collapsedStatic[a]=!0,b.spicetheme.setToggle(!0,a),d.setParam(a,!0)))},setParam:function(a,b){d.objects[a+"_collapsed"]=b.toString(),c.setParam("userConfig",d.objects)}};return d}]),angular.module("SpiceCRM").run(["$templateCache",function(a){"use strict";a.put("themes/SpiceTheme/js/Widgets/Favorites/entry.html",'<li title="{{itemData.module_name}}: {{itemData.item_summary}}"><a href="index.php?module={{itemData.module_name}}&action=DetailView&record={{itemData.item_id}}"><span>{{itemData.item_summary_short}}</span></a><div class="moduleIcon"><img ng-src="themes/SpiceTheme/images/{{itemData.module_name}}.gif" onerror="this.src=\'include/images/blank.gif\'"></div><div class="changeIcon"><a title="{{itemData.module_name}}: {{itemData.item_summary}}" href="index.php?module={{itemData.module_name}}&action=EditView&record={{itemData.item_id}}"><img src="themes/SpiceTheme/images/edit_inline.gif"></a></div></li>'),a.put("themes/SpiceTheme/js/Widgets/Favorites/template.html",'<div id="{{favoritesWidget.name}}" class="shortcuts"><span class="shortcutstitle">{{favoritesWidget.label}}</span><div id="expand_{{favoritesWidget.name}}" class="expander" ng-click="userConfigService.toggle(favoritesWidget.name,true)"><span ng-show="userConfigService.objects.Favorites_collapsed == \'true\'" class="arrow_down"></span> <span ng-show="userConfigService.objects.Favorites_collapsed == \'false\'" class="arrow_up"></span></div><div ng-if="favoritesService.loading">loading...</div><div id="widget_cotent_{{favoritesWidget.name}}" ng-class="\'widget_content \'+favoritesWidget.class()" ng-if="!favoritesService.loading"><ul ng-show="userConfigService.objects.Favorites_collapsed == \'false\'"><favorites-item ng-repeat="object in favoritesService.objects" item-data="object"></favorites-item></ul></div></div>'),a.put("themes/SpiceTheme/js/Widgets/LastViewed/entry.html",'<li title="{{itemData.module_name}}: {{itemData.item_summary}}"><a href="index.php?module={{itemData.module_name}}&action=DetailView&record={{itemData.item_id}}"><span>{{itemData.item_summary_short}}</span></a><div class="moduleIcon"><img ng-src="themes/SpiceTheme/images/{{itemData.module_name}}.gif" onerror="this.src=\'include/images/blank.gif\'"></div><div class="changeIcon"><a title="{{itemData.module_name}}: {{itemData.item_summary}}" href="index.php?module={{itemData.module_name}}&action=EditView&record={{itemData.item_id}}"><img src="themes/SpiceTheme/images/edit_inline.gif"></a></div></li>'),a.put("themes/SpiceTheme/js/Widgets/LastViewed/template.html",'<div id="{{lastViewedWidget.name}}" class="shortcuts"><span class="shortcutstitle">{{lastViewedWidget.label}}</span><div id="expand_{{lastViewedWidget.name}}" class="expander" ng-click="userConfigService.toggle(lastViewedWidget.name,true)"><span ng-show="userConfigService.objects.LastViewed_collapsed == \'true\'" class="arrow_down"></span> <span ng-show="userConfigService.objects.LastViewed_collapsed == \'false\'" class="arrow_up"></span></div><div ng-if="lastViewedService.loading">loading...</div><div id="widget_cotent_{{lastViewedWidget.name}}" ng-class="\'widget_content \'+lastViewedWidget.class()" ng-if="!lastViewedService.loading"><ul ng-show="userConfigService.objects.LastViewed_collapsed == \'false\'"><last-viewed-item ng-repeat="object in lastViewedService.objects" item-data="object"></last-viewed-item></ul></div></div>'),a.put("themes/SpiceTheme/js/Widgets/Shortcuts/entry.html",'<li style="white-space:nowrap"><span ng-if="itemData.URL == \'\'">{{itemData.LABEL}}</span> <a ng-if="itemData.URL !== \'\'" href="{{itemData.URL}}"><span>{{itemData.LABEL}}</span></a></li>'),a.put("themes/SpiceTheme/js/Widgets/Shortcuts/template.html",'<div id="{{shortcutsWidget.name}}" class="shortcuts"><span class="shortcutstitle">{{shortcutsWidget.label}}</span><div id="expand_{{shortcutsWidget.name}}" class="expander" ng-click="userConfigService.toggle(shortcutsWidget.name,true)"><span ng-show="userConfigService.objects.Shortcuts_collapsed == \'true\'" class="arrow_down"></span> <span ng-show="userConfigService.objects.Shortcuts_collapsed == \'false\'" class="arrow_up"></span></div><div ng-if="shortcutsService.loading">loading...</div><div id="widget_cotent_{{shortcutsWidget.name}}" ng-class="\'widget_content \'+shortcutsWidget.class()" ng-if="!shortcutsService.loading"><ul ng-show="userConfigService.objects.Shortcuts_collapsed == \'false\'"><shortcuts-item ng-repeat="object in shortcutsService.objects" item-data="object"></shortcuts-item></ul></div></div>')}]),spicetheme={timedFunction:null,moreModulesCollapsed:!0,groupsCollapsed:!0,footerLineCollapsed:!0,collapsed:[],collapsedStatic:[],selectedGroup:"",menuStore:{},menuItemsStore:{},openItemMenu:null,openingItemMenu:null,currentMenuItem:null,errorcount:0,errorsdisplayed:!1,cpdisplayed:!1,currentEditedPage:null,toggleActivePage:function(a){window.location="index.php?module=Home&action=index&activePage="+a},addPage:function(){$("#pageEdit").insertBefore("#pageItem0"),document.getElementById("pageTitle").value="new Page",document.getElementById("pageColumns").value=2,document.getElementById("moduleTab_HomeMenu").style.display="none",document.getElementById("pageEdit").style.display="block",spicetheme.currentEditedPage="new"},editPage:function(a){$.ajax({url:"KREST/theme/Page/"+a,type:"GET",success:function(a){var b=a;$("#pageEdit").insertAfter("#pageItem"+b.index),document.getElementById("pageTitle").value=b.pageTitle,document.getElementById("pageColumns").value=b.numColumns,0===b.index?document.getElementById("pageEditDeleteButton").style.display="none":document.getElementById("pageEditDeleteButton").style.display="inline",document.getElementById("pageEdit").style.display="block",spicetheme.currentEditedPage=b.index}})},cancelPageEdit:function(){document.getElementById("pageEdit").style.display="none",spicetheme.currentEditedPage=null},commitPageEdit:function(){$.ajax({url:"KREST/theme/Page/"+spicetheme.currentEditedPage,type:"POST",dataType:"json",processData:!1,data:JSON.stringify({pageTitle:document.getElementById("pageTitle").value,pageColumns:document.getElementById("pageColumns").value}),success:function(a){window.location="index.php?module=Home&action=index&activePage="+a}})},deletePage:function(){$.ajax({url:"KREST/theme/Page/"+spicetheme.currentEditedPage,type:"DELETE",dataType:"json",processData:!1,data:JSON.stringify({pageTitle:document.getElementById("pageTitle").value,pageColumns:document.getElementById("pageColumns").value}),success:function(a){window.location="../../../../../index.php"}})},resetPages:function(){$.ajax({url:"KREST/theme/Page/reset",type:"POST",success:function(a){window.location="../../../../../index.php"}})},toggleFavorite:function(){"0"==document.getElementById("beanisfavorite").value?(document.getElementById("beanisfavorite").value="1",document.getElementById("iafavoriteinactive").style.display="none",document.getElementById("iafavoriteactive").style.display="block"):(document.getElementById("beanisfavorite").value="0",document.getElementById("iafavoriteinactive").style.display="block",document.getElementById("iafavoriteactive").style.display="none");var a=document.getElementById("formDetailView");"1"==document.getElementById("beanisfavorite").value?$.ajax({url:"KREST/module/"+a.module.value+"/"+a.record.value+"/favorite",type:"POST",success:function(a){}}):$.ajax({url:"KREST/module/"+a.module.value+"/"+a.record.value+"/favorite",type:"DELETE",success:function(a){}})},toggleMoreModules:function(){this.moreModulesCollapsed?(document.getElementById("moreModuleItems").style.visibility="visible",this.moreModulesCollapsed=!1,$("#MoreModules").mouseleave(function(){document.getElementById("moreModuleItems").style.visibility="hidden",spicetheme.moreModulesCollapsed=!0})):(document.getElementById("moreModuleItems").style.visibility="hidden",this.moreModulesCollapsed=!0)},changeGroup:function(a){this.menuStore[document.getElementById("currentGroup").innerHTML]||(this.menuStore[document.getElementById("currentGroup").innerHTML]=document.getElementById("newSubmenu").innerHTML),document.getElementById("currentGroup").innerHTML=a,document.getElementById("newSubmenu").style.display="none",document.getElementById("newSubmenuloading").style.display="inline",this.menuStore[a]?(document.getElementById("newSubmenu").style.display="inline",document.getElementById("newSubmenuloading").style.display="none",document.getElementById("newSubmenu").innerHTML=this.menuStore[a],$(".newsubmenuitem").mouseenter(function(a){spicetheme.triggerItemMenu(a.currentTarget.id.replace("tab","").replace("moduleTab_","")),spicetheme.openingItemMenu=a.currentTarget.id.replace("tab","").replace("moduleTab_","")}),$(".newsubmenuitem").mouseleave(function(){$("#"+spicetheme.openItemMenu).remove(),spicetheme.openItemMenu=null,spicetheme.openingItemMenu=null})):$.ajax({url:"KREST/theme/changeGroup/"+document.getElementById("currentModule").innerHTML+"/"+a,type:"GET",dataType:"html",processData:!1,success:function(a){document.getElementById("newSubmenu").style.display="inline",document.getElementById("newSubmenuloading").style.display="none",document.getElementById("newSubmenu").innerHTML=a,$(".newsubmenuitem").mouseenter(function(a){spicetheme.triggerItemMenu(a.currentTarget.id.replace("tab","").replace("moduleTab_","")),spicetheme.openingItemMenu=a.currentTarget.id.replace("tab","").replace("moduleTab_","")}),$(".newsubmenuitem").mouseleave(function(){$("#"+spicetheme.openItemMenu).remove(),spicetheme.openItemMenu=null,spicetheme.openingItemMenu=null})}})},toggleGroups:function(){this.groupsCollapsed?(document.getElementById("tabGroupDropDown").style.visibility="visible",this.groupsCollapsed=!1,$("#groupdropdowntab").mouseleave(function(){document.getElementById("tabGroupDropDown").style.visibility="hidden",spicetheme.groupsCollapsed=!0})):(document.getElementById("tabGroupDropDown").style.visibility="hidden",this.groupsCollapsed=!0)},removeItemMenu:function(a){this.openItemMenu,1},triggerRemoveItemMenu:function(a){this.openItemMenu&&this.openItemMenu=="moduleTab_"+a+"Menu"&&(this.timedFunction=window.setTimeout("spicetheme.removeItemMenu('"+a+"')",300))},cancelRemoveItemMenu:function(){this.timedFunction&&(window.clearTimeout(this.timedFunction),this.timedFunction=null)},displayItemMenu:function(a){if(this.currentMenuItem==a&&0===$(".moduletabitemmenu").length&&spicetheme.openingItemMenu==a){var b=$("#"+a+"tab").offset(),c=document.createElement("div");c.id="moduleTab_"+a+"Menu",c.className="moduletabitemmenu",c.style.left=b.left+"px";var d=spicetheme.menuItemsStore[a];c.innerHTML=d.menu+d.lastviewed+d.favorites,document.getElementById(a+"tab").appendChild(c),this.openItemMenu=c.id,$(".newsubmenuitem").mouseleave(function(){$("#"+spicetheme.openItemMenu).remove(),spicetheme.openItemMenu=null})}},getItemMenu:function(a){this.menuItemsStore[a]?spicetheme.displayItemMenu(a):$.ajax({url:"KREST/theme/getMenu/"+currentModule+"/"+a,type:"GET",success:function(b){spicetheme.menuItemsStore[a]="object"==typeof b?b:JSON.parse(b),spicetheme.displayItemMenu(a)}})},triggerItemMenu:function(a){this.timedFunction=window.setTimeout("spicetheme.getItemMenu('"+a+"')",400),this.currentMenuItem=a},cancelLoadItemMenu:function(a){this.timedFunction&&(window.clearTimeout(this.timedFunction),this.timedFunction=null,this.currentMenuItem=null),this.triggerRemoveItemMenu(a)},getErrorCount:function(){errorCountArray=document.getElementById("errormessages").innerHTML.match(/<p class/g),errorCountArray&&(this.errorcount=errorCountArray.length,document.getElementById("errorcount").innerHTML=errorCountArray.length,document.getElementById("errorcountli").style.display="inline"),null!==document.getElementById("statistics")&&(document.getElementById("statistics").innerHTML=document.getElementById("responseTime").innerHTML)},closeCopyright:function(){document.getElementById("copyright").style.display="none",this.cpdisplayed=!1},displayCopyright:function(){this.cpdisplayed?(document.getElementById("copyright").style.display="none",this.cpdisplayed=!1):(cprightpos=$(document.getElementById("poweredbysugarcrm")).offset(),cprightpos.top=cprightpos.top-210,cprightpos.left=cprightpos.left,$(document.getElementById("copyright")).css(cprightpos),document.getElementById("copyright").style.display="inline",this.cpdisplayed=!0)},displayErrors:function(){this.errorsdisplayed?(document.getElementById("errormessages").style.display="none",this.errorsdisplayed=!1):(errorcountpos=$(document.getElementById("errorcount")).offset(),errorcountpos.top=errorcountpos.top-(30*this.errorcount+30),errorcountpos.left=errorcountpos.left,$(document.getElementById("errormessages")).css(errorcountpos),$(document.getElementById("errormessages")).css("height","auto"),document.getElementById("errormessages").style.display="inline",this.errorsdisplayed=!0)},hideActionButtons:function(){document.getElementById("actionmenu").appendChild(document.getElementById("SAVE_HEADER"))},hijackActionMenu:function(){$(".SugarActionMenu").each(function(){var a=$(this).children("li").children("ul").children("li");$(this).append(a)})},hijackModuleTitle:function(){"undefined"!=typeof action_sugar_grp1?"DetailView"!=action_sugar_grp1&&$("#itemactions").css("display","none"):$("#itemactions").css("display","none"),elements=$(".moduleTitle"),elements.length>0&&($("#moduleTitleDummy").addClass("moduleTitle"),$("#moduleTitleDummy").show(),$("#moduleTitleDummy").html($(elements[0]).html()))},registerEvents:function(){$(document).click(function(a){"copyright"!=a.target.id&&"poweredbysugarcrm"!=a.target.id&&spicetheme.cpdisplayed&&(document.getElementById("copyright").style.display="none",spicetheme.cpdisplayed=!1),"errormessages"!=a.target.id&&"errormessages"!=a.target.parentNode.id&&"errorcount"!=a.target.id&&spicetheme.errorsdisplayed&&(document.getElementById("errormessages").style.display="none",spicetheme.errorsdisplayed=!1)}),$(".newsubmenuitem").mouseenter(function(a){spicetheme.triggerItemMenu(a.currentTarget.id.replace("tab","").replace("moduleTab_","")),spicetheme.openingItemMenu=a.currentTarget.id.replace("tab","").replace("moduleTab_","")}),$(".newsubmenuitem").mouseleave(function(){$("#"+spicetheme.openItemMenu).remove(),spicetheme.openItemMenu=null,spicetheme.openingItemMenu=null}),null!==document.getElementById("iareminder")&&($("#iareminder").click(function(){$("#iareminderpicker").show()}),$("#iaremindernew").click(function(){$("#iareminderpicker").show()}),$("#iareminderremove").click(function(){spicetheme.removeReminder()})),$("#SpiceSideBar").sortable({items:"div.shortcuts",distance:15,axis:"y",opacity:.8,cursorAt:{left:5},revert:!0,update:function(a,b){spicetheme.sortSave()}}),$("#SpiceSideBar div.shortcuts span.shortcutstitle").css("cursor","move"),$("#SpiceSideBar").disableSelection(),"undefined"!=typeof action_sugar_grp1&&"undefined"!=typeof subpanelsTabbed&&"DetailView"==action_sugar_grp1&&subpanelsTabbed&&0===$("#groupTabs").length&&spicetheme.subpanelsTabbed()},setDatepicker:function(){"undefined"!=typeof action_sugar_grp1&&null!==document.getElementById("iareminderpicker")&&"DetailView"==action_sugar_grp1&&($("#iareminderpicker").datepicker({dateFormat:cal_date_format.replace(/\%/g,"").replace("Y","yy").replace("m","mm").replace("d","dd"),defaultDate:$("#iareminder").html(),numberOfMonths:2,onSelect:function(a,b){document.getElementById("iareminder").innerHTML=a;var c=document.getElementById("formDetailView");$.ajax({url:"KREST/module/"+c.module.value+"/"+c.record.value+"/reminder",type:"POST",dataType:"html",processData:!1,data:JSON.stringify({reminderDate:a}),success:function(a){$("#widget_cotent_Reminders").html(a),$("#combo_Reminders").html(a)}}),$("#iareminderpicker").hide(),$("#iareminderremove").css("display","inline"),$("#iaremindernew").css("display","none")}}).hide(),""!==$("#iareminder").html()?$("#iareminderremove").css("display","inline"):$("#iaremindernew").css("display","inline"))},removeReminderById:function(a){var b=document.getElementById("formDetailView");$.ajax({url:"KREST/module/"+b.module.value+"/"+a+"/reminder",type:"DELETE",dataType:"html",success:function(a){$("#widget_cotent_Reminders").html(a),$("#combo_Reminders").html(a)}}),void 0!==b&&b.record.value==a&&($("#iareminderremove").css("display","none"),$("#iaremindernew").css("display","inline"),document.getElementById("iareminder").innerHTML="")},removeReminder:function(){$("#iareminderpicker").hide();var a=document.getElementById("formDetailView");$.ajax({url:"KREST/module/"+a.module.value+"/"+a.record.value+"/reminder",type:"DELETE",dataType:"html",success:function(a){$("#widget_cotent_Reminders").html(a),$("#combo_Reminders").html(a)}}),$("#iareminderremove").css("display","none"),$("#iaremindernew").css("display","inline"),document.getElementById("iareminder").innerHTML="",$("#iareminderpicker").datepicker.defaultDate=""},toggleFooterline:function(a,b){this.footerLineCollapsedStatic||!a?(!1===b?($("#footerline").css("width","100%"),$("#expand_footerline span").removeClass("arrow_right"),$("#expand_footerline span").addClass("arrow_left"),$("#welcome_slide").removeAttr("style"),spicetheme.getErrorCount()):($("#footerline").animate({width:"100%"},1e3),setTimeout(function(){$("#expand_footerline span").removeClass("arrow_right"),$("#expand_footerline span").addClass("arrow_left"),$("#welcome_slide").fadeIn(),spicetheme.getErrorCount()},600)),this.footerLineCollapsed=!1,a&&(this.footerLineCollapsedStatic=!1,this.setToggleFooterline(!1))):($("#expand_footerline span").removeClass("arrow_left"),$("#expand_footerline span").addClass("arrow_right"),$("#welcome_slide").fadeOut(),$("#footerline").animate({width:"165px"},1e3),this.footerLineCollapsed=!0,a&&(this.footerLineCollapsedStatic=!0,this.setToggleFooterline(!0)))},toggleFooterline_mouseover:function(a){this.footerLineCollapsedStatic&&("mousein"==a?($("#footerline").animate({width:"100%"},500),setTimeout(function(){$("#welcome_slide").fadeIn()},200),this.footerLineCollapsed=!1):($("#welcome_slide").fadeOut("fast"),setTimeout(function(){$("#footerline").animate({width:"165px"},500)},200),this.footerLineCollapsed=!0))},setToggleFooterline:function(a){$.ajax({url:"KREST/theme/setToggleFooterline",type:"POST",dataType:"json",processData:!1,data:JSON.stringify({footerLineCollapsed:a}),success:function(a){}})},toggle:function(item,save,animated){this.collapsedStatic[item]||!save?(!1===load_closed&&0===$("#"+item+" ul").length&&save&&$.ajax({url:"KREST/theme/refresh/"+currentModule+"/"+item,type:"GET",success:function(result){if(result=result,$("#"+item+" div.widget_content").append(result.content),result.jsinclude.length>0&&$('head [src="'+result.jsinclude+'"]').length<1){var snode=document.createElement("script");snode.setAttribute("type","text/javascript"),snode.setAttribute("src",result.jsinclude),document.getElementsByTagName("head")[0].appendChild(snode)}result.jsexecute.length>0&&eval(result.jsexecute)}}),!1===animated?($("#expand_"+item+" span").removeClass("arrow_down"),$("#expand_"+item+" span").addClass("arrow_up"),$("#"+item+" div.widget_content").addClass("style")):($("#expand_"+item+" span").removeClass("arrow_down"),$("#expand_"+item+" span").addClass("arrow_up"),$("#"+item+" div.widget_content").removeClass("close"),$("#"+item+" div.widget_content").addClass("open")),this.collapsed[item]=!1,save&&(this.collapsedStatic[item]=!1,this.setToggle(!1,item))):($("#expand_"+item+" span").removeClass("arrow_up"),$("#expand_"+item+" span").addClass("arrow_down"),$("#"+item+" div.widget_content").removeClass("open"),$("#"+item+" div.widget_content").addClass("close"),this.collapsed[item]=!0,save&&(this.collapsedStatic[item]=!0,this.setToggle(!0,item)))},toggleSideBar:function(a,b){var c="SideBar";this.collapsedStatic[c]||!a?(!1===b?($("#leftBar").css("left","0px"),$("#SideBarExpander_arrow").removeClass("arrow_right"),$("#SideBarExpander_arrow").addClass("arrow_left"),$("div#content").css("margin-left","175px")):($("#leftBar").removeClass("hide"),$("div#content").removeClass("sidebar_closed"),$("#leftBar").addClass("show"),$("div#content").addClass("sidebar_open"),setTimeout(function(){$("#SideBarExpander_arrow").removeClass("arrow_right"),$("#SideBarExpander_arrow").addClass("arrow_left")},600)),this.collapsed[c]=!1,a&&(this.collapsedStatic[c]=!1,this.setToggle(!1,c))):($("#SideBarExpander_arrow").removeClass("arrow_left"),$("#SideBarExpander_arrow").addClass("arrow_right"),$("#leftBar").removeClass("show"),$("div#content").removeClass("sidebar_open"),$("#leftBar").addClass("hide"),$("div#content").addClass("sidebar_closed"),this.collapsed[c]=!0,a&&(this.collapsedStatic[c]=!0,this.setToggle(!0,c)))},toggleSideBar_mouseover:function(a){var b="SideBar";this.collapsedStatic[b]&&("mousein"==a&&this.collapsed[b]?($("#leftBar").removeClass("hide"),$("#leftBar").addClass("show"),$(".leftbar").css("border-right-width","1px"),this.collapsed[b]=!1,this.timedFunction=null):($("#leftBar").removeClass("show"),$("#leftBar").addClass("hide"),$(".leftbar").css("border-right-width","15px"),this.collapsed[b]=!0))},triggerSideBar:function(a){this.timedFunction=window.setTimeout("spicetheme.toggleSideBar_mouseover('"+a+"')",400)},cancelSideBar:function(a){this.timedFunction?(window.clearTimeout(this.timedFunction),this.timedFunction=null):spicetheme.toggleSideBar_mouseover(a)},getToggle:function(a){!0!==toggled[a]?("SideBar"==a?spicetheme.toggleSideBar(!1,!1):spicetheme.toggle(a,!1,!1),spicetheme.collapsedStatic[a]=!1):spicetheme.collapsedStatic[a]=!0},setToggle:function(a,b){$.ajax({url:"KREST/theme/setToggle/"+b+"/"+a,type:"GET",success:function(a){}})},sortSave:function(){var a="";$("#leftBar div.shortcuts:not(#actionmenu)").each(function(){a+=this.id+","}),$.ajax({url:"KREST/theme/saveSort",type:"POST",dataType:"json",processData:!1,data:JSON.stringify({order:a}),success:function(a){}})},showConfigSideBar:function(){$.ajax({url:"KREST/theme/showConfigSideBar",processData:!1,dataType:"html",success:function(a){$("body").append('<div id="config_sidebar_dialog">'+a+"</div>"),$("#config_sidebar_dialog").dialog({modal:!0,buttons:{Save:function(){var a="";$("#config_sidebar_dialog input:checked").each(function(){a+=$(this).attr("name")+","}),$.ajax({url:"KREST/theme/setWidgetUserConfig",type:"POST",dataType:"json",processData:!1,data:JSON.stringify({param:"SpiceThemeSideBarConfig",value:a}),success:function(a){location.reload()}})},Cancel:function(){$(this).dialog("close")}}})}})},subpanelsTabbed:function(){var a=1;$("#subpanel_list li").hide(),$("#subpanel_list").before('<ul id="subpanels_tabbed_list" class="subpanelTablist" />'),$('#subpanel_list li[id^="whole_subpanel_"]').each(function(){$this=$(this);var b=$("#subpanel_list li#"+this.id+' div[id^="subpanel_title_"] h3 > span').text().trim(),c=this.id.split("whole_subpanel_")[1],d=document.createElement("li");d.id="subpanelTabbed_"+c,d.title=c,d.style.cursor="pointer",$(d).append('<a href="#">'+b+"</a>"),$(d).hover(function(){$("#whole_subpanel_"+this.title).show(),$('#subpanel_list li[id!="whole_subpanel_'+this.title+'"]').hide(),$("#subpanels_tabbed_list li a.current").removeClass("current"),$(this).children("a").addClass("current")},function(){}),1==a&&($("#whole_subpanel_"+d.title).show(),$(d).children("a").addClass("current")),$("#subpanels_tabbed_list").append(d),a++});var b=document.createElement("li");b.id="subpanelTabbed_all",b.title="all",b.style.cursor="pointer",$(b).append('<a href="#">All</a>'),$(b).hover(function(){$("#subpanel_list li").show(),$("#subpanels_tabbed_list li a.current").removeClass("current"),$(this).children("a").addClass("current")},function(){}),$("#subpanels_tabbed_list").append(b)},initialize:function(){this.getErrorCount(),this.hijackModuleTitle(),this.registerEvents(),this.setDatepicker()},displayLogin:function(a){$("body").html(a),$('#form input[name="login_module"]').val(currentModule),$('#form input[name="login_record"]').val(currentRecord),$('#form input[name="login_action"]').val(currentAction)},displayGlobalLinksSubMenu:function(a){$("#"+a+"_submenu").show(),$("#"+a+"_submenu").offset({left:$("#"+a+"_link").offset().left-5,top:$("#"+a+"_link").offset().top-$("#"+a+"_submenu").height()-18})},quickNotes:{quickNotesCount:0,quickNotesLoaded:!1,filtered:!1,open:!1,displayQuickNotes:function(){spicetheme.quickNotes.open?($("#ianotes_container").fadeOut(),spicetheme.quickNotes.open=!1):(spicetheme.quickNotes.quickNotesCount<1&&$("#ianotes_new_container").slideDown(),spicetheme.quickNotes.quickNotesLoaded?$("#ianotes_container").fadeIn():$.ajax({url:"KREST/module/"+currentModule+"/"+document.forms.DetailView.record.value+"/note",type:"GET",success:function(a){var b=a;if(b.length>0){for(var c=0;c<b.length;c++){var d=document.createElement("li");d.id=b[c].id,"1"==b[c].global&&(d.className="ianotes_global");var e=document.createElement("span");if(e.className="ianotes_title",e.innerHTML=b[c].user_name+", "+b[c].date,"1"==b[c].own){var f=document.createElement("img");f.src="themes/SpiceTheme/images/Trash.png",f.className="ianotes_delete",
f.title="delete",f.onclick=function(){spicetheme.quickNotes.deleteQuickNote(this.parentNode.id),$(this).parent().remove()}}var g=document.createElement("div");g.id=b[c].id+"_text",g.innerHTML=b[c].text,"1"==b[c].own&&(g.title="click to edit",g.onclick=function(){spicetheme.quickNotes.editQuickNote(this.id)}),$(d).append(g),$(d).prepend(e),"1"==b[c].own&&$(d).prepend(f),$("#ianotes_container ul").append(d)}$("#ianotes_new_container").slideUp(),spicetheme.quickNotes.quickNotesLoaded=!0}else spicetheme.quickNotes.quickNotesLoaded=!0,$("#ianotes_new_container").slideDown();$("#ianotes_header_title").html("QuickNotes for "+$("#leftBar div.moduleTitle h2").text().trim()),$("#ianotes_container").fadeIn()}}),spicetheme.quickNotes.open=!0)},filterQuickNotes:function(){spicetheme.quickNotes.filtered?($("#ianotes_container li.ianotes_global:not(#ianotes_new_container)").show(),spicetheme.quickNotes.filtered=!1):($("#ianotes_container li.ianotes_global:not(#ianotes_new_container)").hide(),spicetheme.quickNotes.filtered=!0)},setQuickNoteIcon:function(){0===spicetheme.quickNotes.quickNotesCount?(document.getElementById("ianotesinactive").style.display="block",document.getElementById("ianotesactive").style.display="none"):(document.getElementById("ianotesinactive").style.display="none",document.getElementById("ianotesactive").style.display="block")},saveQuickNote:function(){$.ajax({url:"KREST/module/"+currentModule+"/"+document.forms.DetailView.record.value+"/note",dataType:"json",processData:!1,data:JSON.stringify({text:document.forms.ianotes_new.text.value,global:$('#ianotes_new input[name="global"]:checked').length}),type:"POST",success:function(a){var b=a,c=document.createElement("li");c.id=b[0].id,"1"==b[0].global&&($("#ianotes_new_container").removeClass("ianotes_global"),c.className="ianotes_global");var d=document.createElement("span");d.className="ianotes_title",d.innerHTML=b[0].user_name+", "+b[0].date;var e=document.createElement("img");e.src="themes/SpiceTheme/images/Trash.png",e.className="ianotes_delete",e.title="delete",e.onclick=function(){spicetheme.quickNotes.deleteQuickNote(this.parentNode.id),$(this).parent().remove()};var f=document.createElement("div");f.id=b[0].id+"_text",f.innerHTML=b[0].text,f.title="click to edit",f.onclick=function(){arguments[0].originalTarget==this&&spicetheme.quickNotes.editQuickNote(this.id)},$(c).append(f),$(c).prepend(d),$(c).prepend(e),$("#ianotes_new_container").hide(),$("#ianotes_new textarea").val(""),$("#ianotes_new textarea").text(""),$("#ianotes_new textarea").html(""),$('#ianotes_new input[name="global"]').removeAttr("checked"),$("#ianotes_new_container").after(c),spicetheme.quickNotes.quickNotesCount++,spicetheme.quickNotes.setQuickNoteIcon()}})},editQuickNote:function(a){$("#"+a).hide();var b=$("#"+a).parent().attr("id");$("#"+b+" img#ianotes_delete").hide();var c=document.createElement("form");c.className="action_buttons",c.method="POST",c.action="#",c.id=b+"_form";var d=document.createElement("textarea");d.rows="4",d.id=b+"_edittext",d.innerHTML=$("#"+b+"_text").text();var e=document.createElement("label");e.style.verticalAlign="bottom",e.innerHTML="global Note:";var f=document.createElement("input");f.id=b+"_global",f.type="checkbox",f.value="1",$("#"+b).hasClass("ianotes_global")&&$(f).attr("checked","checked"),f.onclick=function(){$("#"+b).toggleClass("ianotes_global")};var g=document.createElement("input");g.className="button",g.type="reset",g.value="cancel",g.onclick=function(){spicetheme.quickNotes.abortEditQuickNote($(this).parent().parent().attr("id"))};var h=document.createElement("input");h.className="button",h.type="button",h.value="save",h.onclick=function(){return spicetheme.quickNotes.saveEditQuickNote($(this).parent().parent().attr("id")),!1},$(c).append(d),$(c).append("<br>"),$(c).append(e),$(c).append("&nbsp;"),$(c).append(f),$(c).append("&nbsp;"),$(c).append(g),$(c).append("&nbsp;"),$(c).append(h),$("#"+b).append(c)},saveEditQuickNote:function(a){$("#"+a+"_form").hide(),$.ajax({url:"KREST/module/"+currentModule+"/"+document.forms.DetailView.record.value+"/note/"+a,dataType:"json",processData:!1,data:JSON.stringify({text:$("#"+a+"_edittext").val(),global:$("#"+a+"_global:checked").length}),type:"POST",success:function(a){}}),$("#"+a+"_text").html(spicetheme.quickNotes.nl2br($("#"+a+"_edittext").val(),!1)),$("#"+a+"_form").remove(),$("#"+a+"_text").show(),$("#"+a+" img#ianotes_delete").removeAttr("style")},abortEditQuickNote:function(a){$("#"+a+"_form").remove(),$("#"+a+"_text").show(),$("#"+a+" img#ianotes_delete").removeAttr("style")},deleteQuickNote:function(a){$.ajax({url:"KREST/module/"+currentModule+"/"+document.forms.DetailView.record.value+"/note/"+a,type:"DELETE",success:function(a){spicetheme.quickNotes.quickNotesCount--,spicetheme.quickNotes.setQuickNoteIcon(),spicetheme.quickNotes.quickNotesCount<1&&($("#ianotes_new_container").slideDown(),$("#ianotes_container").fadeOut(),spicetheme.quickNotes.open=!1)}})},formClose:function(){spicetheme.quickNotes.quickNotesCount<1&&($("#ianotes_container").fadeOut(),spicetheme.quickNotes.open=!1),$("#ianotes_new_container").slideUp()},nl2br:function(a,b){return(a+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1"+(b||void 0===b?"<br />":"<br>")+"$2")}},attachments:{attachmentsCount:0,attachmentsLoaded:!1,filtered:!1,open:!1,file:!1,formdata:!1,displayAttachments:function(){spicetheme.attachments.open?($("#iaattachments_container").fadeOut(),spicetheme.attachments.open=!1):(spicetheme.attachments.attachmentsCount<1&&$("#iaattachments_new_container").slideDown(),spicetheme.attachments.attachmentsLoaded?$("#iaattachments_container").fadeIn():$.ajax({url:"KREST/module/"+currentModule+"/"+document.forms.DetailView.record.value+"/attachment/ui",type:"GET",success:function(a){var b=a;if(b.length>0){for(var c=0;c<b.length;c++){var d=document.createElement("li");d.id=b[c].id;var e=document.createElement("span");e.className="iaattachments_title",e.innerHTML=b[c].user_name+", "+b[c].date;var f=document.createElement("img");f.src="themes/SpiceTheme/images/Trash.png",f.className="iaattachments_delete",f.title="delete",f.onclick=function(){spicetheme.attachments.deleteAttachment(this.parentNode.id),$(this).parent().remove()};var g=document.createElement("div");g.id=b[c].id+"_text",g.innerHTML='<a href="'+b[c].url+'">'+b[c].filename+"</a><br>"+b[c].text,$(d).append(g),$(d).prepend(e),$(d).prepend(f),$("#iaattachments_container ul").append(d)}$("#iaattachments_new_container").slideUp(),spicetheme.attachments.attachmentsLoaded=!0}else spicetheme.attachments.attachmentsLoaded=!0,$("#iaattachments_new_container").slideDown();$("#iaattachments_header_title").html("Attachments for "+$("#leftBar div.moduleTitle h2").text().trim()),$("#iaattachments_container").fadeIn()}}),spicetheme.attachments.open=!0)},filterAttachments:function(){spicetheme.attachments.filtered?($("#iaattachments_container li.iaattachments_global:not(#iaattachments_new_container)").show(),spicetheme.attachments.filtered=!1):($("#iaattachments_container li.iaattachments_global:not(#iaattachments_new_container)").hide(),spicetheme.attachments.filtered=!0)},setAttachmentIcon:function(){0===spicetheme.attachments.attachmentsCount?(document.getElementById("iaattachmentsinactive").style.display="block",document.getElementById("iaattachmentsactive").style.display="none",$("#iaattachmentscount").html("")):(document.getElementById("iaattachmentsinactive").style.display="none",document.getElementById("iaattachmentsactive").style.display="block",$("#iaattachmentscount").html(spicetheme.attachments.attachmentsCount))},saveAttachment:function(){return spicetheme.attachments.formdata=new FormData,$("#iaattachments_new #iaattachments_new_file")[0].files.length>0&&spicetheme.attachments.formdata.append("file",$("#iaattachments_new #iaattachments_new_file")[0].files[0],$("#iaattachments_new #iaattachments_new_file")[0].files[0].name),!1!==spicetheme.attachments.file&&spicetheme.attachments.formdata.append("file",spicetheme.attachments.file,spicetheme.attachments.file.name),spicetheme.attachments.formdata.append("text",$("#iaattachments_new #iaattachments_new_text").val()),$.ajax({url:"KREST/module/"+currentModule+"/"+document.forms.DetailView.record.value+"/attachment/ui",processData:!1,contentType:!1,data:spicetheme.attachments.formdata,type:"POST",success:function(a){var b=a,c=document.createElement("li");c.id=b[0].id;var d=document.createElement("span");d.className="iaattachments_title",d.innerHTML=b[0].user_name+", "+b[0].date;var e=document.createElement("img");e.src="themes/SpiceTheme/images/Trash.png",e.className="iaattachments_delete",e.title="delete",e.onclick=function(){spicetheme.attachments.deleteAttachment(this.parentNode.id),$(this).parent().remove()};var f=document.createElement("div");f.id=b[0].id+"_text",f.innerHTML='<a href="'+b[0].url+'">'+b[0].filename+"</a><br>"+b[0].text,$(c).append(f),$(c).prepend(d),$(c).prepend(e),$("#iaattachments_new_container").hide(),$("#iaattachments_new textarea").val(""),$("#iaattachments_new textarea").text(""),$("#iaattachments_new textarea").html(""),$("#iaattachments_new_container").after(c),$("#iaattachments_new_drop").removeClass("dropactive"),$("#iaattachments_new_list div").remove(),$("#iaattachments_new_status").show(),$("#iaattachments_new_drop").show(),spicetheme.attachments.attachmentsCount++,spicetheme.attachments.setAttachmentIcon()}}),!1},deleteAttachment:function(a){$.ajax({url:"KREST/module/"+currentModule+"/"+document.forms.DetailView.record.value+"/attachment/"+a,type:"DELETE",success:function(a){spicetheme.attachments.attachmentsCount--,$("#iaattachmentscount").html(spicetheme.attachments.attachmentsCount),spicetheme.attachments.setAttachmentIcon(),spicetheme.attachments.attachmentsCount<1&&($("#iaattachments_new_container").slideDown(),$("#iaattachments_container").fadeOut(),spicetheme.attachments.open=!1,$("#iaattachmentscount").html(""))}})},formClose:function(){spicetheme.attachments.attachmentsCount<1&&($("#iaattachments_container").fadeOut(),spicetheme.attachments.open=!1),$("#iaattachments_new_container").slideUp(),$("#iaattachments_new textarea").val(""),$("#iaattachments_new textarea").text(""),$("#iaattachments_new textarea").html(""),$("#iaattachments_new_drop").removeClass("dropactive"),$("#iaattachments_new_list div").remove(),$("#iaattachments_new_status").show(),$("#iaattachments_new_drop").show()},nl2br:function(a,b){return(a+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1"+(b||void 0===b?"<br />":"<br>")+"$2")}}},$(function(){function a(a,b,c){a&&(a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent?a.attachEvent("on"+b,c):a["on"+b]=c)}$.ajaxSetup({error:function(a,b){401===a.status?location.reload():(console.log("Uncaught Error: "+b+"\nDetails:"+arguments[2].message+"\nResponse:"+a.responseText),console.log(a))}}),window.FileReader?($("#iaattachments_new_file").hide(),$("#iaattachments_new_status").click(function(){$("#iaattachments_new_file").trigger("click")}),Function.prototype.bindToEventHandler=function(){var a=this,b=Array.prototype.slice.call(arguments);return function(c){c=c||window.event,b.unshift(c),a.apply(this,b)}},a(window,"load",function(){function b(a){return a.preventDefault&&a.preventDefault(),$("#iaattachments_new_drop").addClass("dropactive"),!1}function c(a){return a.preventDefault&&a.preventDefault(),$("#iaattachments_new_drop").removeClass("dropactive"),!1}function d(a){return a.preventDefault&&a.preventDefault(),!1===spicetheme.attachments.open&&spicetheme.attachments.displayAttachments(),$("#iaattachments_new_container").slideDown(),$("#iaattachments_new_drop").addClass("dropactive"),!1}var e=document.getElementById("iaattachments_new_status"),f=document.getElementById("iaattachments_new_drop"),g=document.getElementById("iaattachments_new_list");a(f,"dragstart",b),a(f,"dragover",b),a(f,"dragenter",b),a(window,"dragstart",d),a(window,"dragover",d),a(window,"dragenter",d),a(f,"dragleave",c),a(f,"dragend",c),a(window,"dragleave",c),a(window,"dragend",c),a(f,"drop",function(b){if(b=b||window.event,b.preventDefault&&b.preventDefault(),1==g.getElementsByTagName("div").length)return!1;for(var c=b.dataTransfer,d=c.files,h=0;h<d.length;h++){var i=d[h],j=new FileReader;a(j,"loadend",function(a,b){var c=(this.result,document.createElement("div"));c.innerHTML="Loaded : "+b.name+" size "+b.size+" B",g.appendChild(c);g.getElementsByTagName("div").length;document.getElementById("iaattachments_new_file").files[0]=b,spicetheme.attachments.file=b,$(f).hide(),$(e).hide()}.bindToEventHandler(i)),j.readAsDataURL(i)}return!1})})):($("#iaattachments_new_file").show(),$("#iaattachments_new_status").hide(),$("#iaattachments_new_drop").hide(),$("#iaattachments_new_list").hide())});